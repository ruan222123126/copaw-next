<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NextAI 控制台</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="ambient ambient-a"></div>
    <div class="ambient ambient-b"></div>
    <div class="app-shell">
      <header class="topbar">
        <div class="title-block">
          <p class="kicker">NextAI</p>
          <h1 data-i18n="app.console">控制台</h1>
        </div>
        <div class="topbar-actions">
          <button
            id="settings-toggle"
            class="settings-toggle"
            type="button"
            aria-controls="settings-popover"
            aria-expanded="false"
            data-i18n-aria-label="control.settings"
          >
            <svg class="settings-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
              <path d="M10.4 2.7a1 1 0 0 1 1.2-.6l1.2.4a1 1 0 0 0 1 .2l1.1-.7a1 1 0 0 1 1.3.2l1.4 1.5a1 1 0 0 1 .1 1.3l-.8 1a1 1 0 0 0-.2 1l.4 1.3a1 1 0 0 0 .8.7l1.3.2a1 1 0 0 1 .9 1v2a1 1 0 0 1-.9 1l-1.3.2a1 1 0 0 0-.8.7l-.4 1.3a1 1 0 0 0 .2 1l.8 1a1 1 0 0 1-.1 1.3l-1.4 1.5a1 1 0 0 1-1.3.2l-1.1-.7a1 1 0 0 0-1-.2l-1.2.4a1 1 0 0 1-1.2-.6l-.5-1.2a1 1 0 0 0-.9-.6h-1.2a1 1 0 0 0-.9.6l-.5 1.2a1 1 0 0 1-1.2.6l-1.2-.4a1 1 0 0 0-1 .2l-1.1.7a1 1 0 0 1-1.3-.2L2.6 20a1 1 0 0 1-.1-1.3l.8-1a1 1 0 0 0 .2-1l-.4-1.3a1 1 0 0 0-.8-.7l-1.3-.2a1 1 0 0 1-.9-1V11a1 1 0 0 1 .9-1l1.3-.2a1 1 0 0 0 .8-.7l.4-1.3a1 1 0 0 0-.2-1l-.8-1a1 1 0 0 1 .1-1.3L4 2a1 1 0 0 1 1.3-.2l1.1.7a1 1 0 0 0 1 .2l1.2-.4a1 1 0 0 1 1.2.6l.5 1.2a1 1 0 0 0 .9.6h1.2a1 1 0 0 0 .9-.6l.5-1.2Z"></path>
              <circle cx="12" cy="12" r="3.2"></circle>
            </svg>
          </button>
          <div id="settings-popover" class="settings-popover modal-shell is-hidden" aria-hidden="true">
            <div class="modal-backdrop" data-settings-close="true"></div>
            <section class="settings-panel" role="dialog" aria-modal="true" data-i18n-aria-label="control.settingsPanelLabel">
              <div class="settings-panel-head">
                <h2 data-i18n="control.settingsPanelLabel">控制台设置</h2>
                <button id="settings-popover-close" class="secondary-btn" type="button" data-settings-close="true" data-i18n="common.close">关闭</button>
              </div>
              <div class="controls">
                <label>
                  <span data-i18n="control.apiBase">API 地址</span>
                  <input id="api-base" type="url" placeholder="http://127.0.0.1:8088" />
                </label>
                <label>
                  <span data-i18n="control.apiKey">API Key</span>
                  <input id="api-key" type="password" placeholder="change-me" data-i18n-placeholder="control.apiKeyPlaceholder" />
                </label>
                <label>
                  <span data-i18n="control.userId">用户 ID</span>
                  <input id="user-id" type="text" placeholder="demo-user" />
                </label>
                <label>
                  <span data-i18n="control.channel">渠道</span>
                  <input id="channel" type="text" placeholder="console" readonly />
                </label>
                <label>
                  <span data-i18n="control.locale">语言</span>
                  <select id="locale-select">
                    <option value="zh-CN" data-i18n="locale.zhCN">中文</option>
                    <option value="en-US" data-i18n="locale.enUS">English</option>
                  </select>
                </label>
                <button id="reload-chats" type="button" data-i18n="control.reloadChats">刷新会话</button>
              </div>
            </section>
          </div>
        </div>
      </header>

      <nav class="tab-strip panel" aria-label="控制台标签页" data-i18n-aria-label="tab.ariaLabel">
        <button class="tab-btn active" data-tab="chat" type="button" data-i18n="tab.chat">聊天</button>
        <button class="tab-btn" data-tab="search" type="button" data-i18n="tab.search">搜索</button>
        <button class="tab-btn" data-tab="models" type="button" data-i18n="tab.models">模型</button>
        <button class="tab-btn" data-tab="channels" type="button" data-i18n="tab.channels">渠道</button>
        <button class="tab-btn" data-tab="workspace" type="button" data-i18n="tab.workspace">配置</button>
        <button class="tab-btn" data-tab="cron" type="button" data-i18n="tab.cron">定时任务</button>
      </nav>

      <div class="panel panel-status">
        <span id="status-line" class="status-line">就绪</span>
      </div>

      <main>
        <section id="panel-chat" class="tab-panel is-active">
          <div class="chat-layout">
            <aside class="sidebar panel">
              <div class="panel-head">
                <h2 data-i18n="chat.sidebarTitle">会话</h2>
                <button id="new-chat" type="button" data-i18n="chat.new">新建会话</button>
              </div>
              <ul id="chat-list" class="chat-list"></ul>
            </aside>

            <section class="chat panel">
              <div class="panel-head chat-head">
                <h2 id="chat-title">草稿会话</h2>
                <span id="chat-session" class="session-badge"></span>
              </div>

              <ul id="message-list" class="messages"></ul>

              <form id="composer" class="composer">
                <textarea
                  id="message-input"
                  rows="3"
                  placeholder="输入消息，流式调用 /agent/process 获取回复"
                  data-i18n-placeholder="chat.inputPlaceholder"
                ></textarea>
                <div class="composer-actions">
                  <button id="send-btn" type="submit" data-i18n="chat.send">发送（SSE）</button>
                </div>
              </form>
            </section>
          </div>
        </section>

        <section id="panel-search" class="tab-panel panel stack-panel">
          <div class="panel-head">
            <h2 data-i18n="search.title">搜索会话</h2>
          </div>
          <div class="panel-body stack-block search-panel-body">
            <section class="subpanel">
              <form class="stack-form search-form" id="search-chat-form">
                <label>
                  <span data-i18n="search.inputLabel">关键词</span>
                  <input
                    id="search-chat-input"
                    type="search"
                    placeholder="输入会话名、Session ID、用户 ID 或渠道"
                    data-i18n-placeholder="search.inputPlaceholder"
                  />
                </label>
              </form>
              <p class="hint" data-i18n="search.hint">按会话名、Session ID、用户 ID、渠道进行匹配。</p>
            </section>
            <section class="subpanel">
              <h3 data-i18n="search.results">搜索结果</h3>
              <ul id="search-chat-results" class="search-result-list detail-list"></ul>
            </section>
          </div>
        </section>

        <section id="panel-models" class="tab-panel panel stack-panel">
          <div class="panel-head">
            <h2 data-i18n="models.title">模型</h2>
            <div class="actions-row panel-actions">
              <button id="models-add-provider-btn" type="button" data-i18n="models.addProvider">添加提供商</button>
              <button id="refresh-models" type="button" data-i18n="common.refresh">刷新</button>
            </div>
          </div>
          <div class="panel-body">
            <section class="subpanel">
              <h3 data-i18n="models.activeModel">当前激活模型</h3>
              <form id="models-active-form" class="stack-form">
                <div class="active-model-grid">
                  <label>
                    <span data-i18n="models.provider">提供商</span>
                    <select id="models-active-provider-select"></select>
                  </label>
                  <label>
                    <span data-i18n="models.modelFromProvider">模型（来自提供商）</span>
                    <select id="models-active-model-select"></select>
                  </label>
                  <label>
                    <span data-i18n="models.modelManual">模型（手动覆盖）</span>
                    <input
                      id="models-active-model-manual-input"
                      type="text"
                      placeholder="可选模型 ID"
                      data-i18n-placeholder="models.modelManualPlaceholder"
                    />
                  </label>
                </div>
                <div class="actions-row">
                  <button id="models-set-active-btn" type="submit" data-i18n="models.setActive">设为激活</button>
                </div>
              </form>
              <p id="models-active-summary" class="item-meta"></p>
            </section>
            <section class="subpanel">
              <h3 data-i18n="models.providers">提供商</h3>
              <ul id="models-provider-list" class="detail-list provider-grid"></ul>
            </section>
          </div>
        </section>

        <section id="panel-channels" class="tab-panel panel stack-panel">
          <div class="panel-head">
            <h2 data-i18n="channels.title">渠道</h2>
            <button id="refresh-qq-channel" type="button" data-i18n="common.refresh">刷新</button>
          </div>
          <div class="panel-body stack-block">
            <section class="subpanel">
              <h3 data-i18n="workspace.qqChannelTitle">QQ 渠道配置</h3>
              <p class="hint" data-i18n="workspace.qqChannelHint">读取并保存 `/config/channels/qq` 配置。</p>
              <form id="qq-channel-form" class="stack-form">
                <div class="channel-config-grid">
                  <label class="checkbox-inline">
                    <input id="qq-channel-enabled" type="checkbox" />
                    <span data-i18n="workspace.qqEnabled">启用 QQ 渠道</span>
                  </label>
                  <label>
                    <span data-i18n="workspace.qqAppID">QQ App ID</span>
                    <input id="qq-channel-app-id" type="text" placeholder="app-xxx" />
                  </label>
                  <label>
                    <span data-i18n="workspace.qqClientSecret">QQ Client Secret</span>
                    <input id="qq-channel-client-secret" type="password" placeholder="secret-xxx" />
                  </label>
                  <label>
                    <span data-i18n="workspace.qqBotPrefix">Bot 前缀</span>
                    <input id="qq-channel-bot-prefix" type="text" placeholder="[BOT] " />
                  </label>
                  <label>
                    <span data-i18n="workspace.qqTargetType">目标类型</span>
                    <select id="qq-channel-target-type">
                      <option value="c2c">c2c</option>
                      <option value="group">group</option>
                      <option value="guild">guild</option>
                    </select>
                  </label>
                  <label>
                    <span data-i18n="workspace.qqAPIEnvironment">API 环境</span>
                    <select id="qq-channel-api-env">
                      <option value="production" data-i18n="workspace.qqAPIEnvironmentProduction">生产</option>
                      <option value="sandbox" data-i18n="workspace.qqAPIEnvironmentSandbox">沙箱</option>
                    </select>
                  </label>
                  <label>
                    <span data-i18n="workspace.qqTimeoutSeconds">超时秒数</span>
                    <input id="qq-channel-timeout-seconds" type="number" min="1" step="1" placeholder="8" />
                  </label>
                </div>
                <div class="actions-row">
                  <button id="save-qq-channel" type="submit" data-i18n="workspace.qqSave">保存 QQ 配置</button>
                </div>
              </form>
            </section>
          </div>
        </section>

        <section id="panel-workspace" class="tab-panel panel stack-panel">
          <div class="panel-head">
            <h2 data-i18n="workspace.title">配置文件</h2>
            <div class="actions-row panel-actions">
              <button id="workspace-import-open-btn" type="button" aria-controls="workspace-import-modal" aria-expanded="false" data-i18n="workspace.importJSON">
                导入 JSON
              </button>
              <button id="refresh-workspace" type="button" data-i18n="common.refresh">刷新</button>
            </div>
          </div>
          <div class="panel-body stack-block">
            <section class="subpanel">
              <h3 data-i18n="workspace.files">配置文件列表</h3>
              <p class="hint" data-i18n="workspace.filesHint">读取 `GET /workspace/files`，选择后可编辑配置。</p>
              <div class="table-wrap">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th data-i18n="workspace.path">路径</th>
                      <th data-i18n="workspace.summary">简介</th>
                      <th data-i18n="workspace.size">大小</th>
                      <th data-i18n="workspace.action">操作</th>
                    </tr>
                  </thead>
                  <tbody id="workspace-files-body"></tbody>
                </table>
              </div>
              <form id="workspace-create-file-form" class="stack-form">
                <label>
                  <span data-i18n="workspace.newPath">新建配置文件路径</span>
                  <input id="workspace-new-path" type="text" placeholder="notes/demo.md" data-i18n-placeholder="workspace.newPathPlaceholder" />
                </label>
                <button id="workspace-create-file-btn" type="submit" data-i18n="workspace.createFile">新建技能配置文件</button>
              </form>
            </section>
          </div>
        </section>

        <section id="panel-cron" class="tab-panel panel stack-panel">
          <div class="panel-head">
            <h2 data-i18n="cron.title">定时任务</h2>
            <div class="actions-row panel-actions">
              <button id="cron-create-open-btn" type="button" aria-controls="cron-create-modal" aria-expanded="false" data-i18n="cron.openCreateModal">
                打开创建窗口
              </button>
              <button id="refresh-cron" type="button" data-i18n="common.refresh">刷新</button>
            </div>
          </div>
          <div class="panel-body stack-block">
            <section class="subpanel">
              <h3 data-i18n="cron.jobs">任务列表</h3>
              <div class="table-wrap">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th data-i18n="cron.id">ID</th>
                      <th data-i18n="cron.name">名称</th>
                      <th data-i18n="cron.enabled">启用</th>
                      <th data-i18n="cron.nextRun">下次运行</th>
                      <th data-i18n="cron.status">状态</th>
                      <th data-i18n="cron.action">操作</th>
                    </tr>
                  </thead>
                  <tbody id="cron-jobs-body"></tbody>
                </table>
              </div>
            </section>
          </div>
        </section>
      </main>

      <div id="workspace-editor-modal" class="modal-shell is-hidden" aria-hidden="true">
        <div class="modal-backdrop" data-workspace-editor-close="true"></div>
        <section class="workspace-editor-modal-panel" role="dialog" aria-modal="true" aria-labelledby="workspace-editor-modal-title">
          <div class="workspace-editor-modal-head">
            <h2 id="workspace-editor-modal-title" data-i18n="workspace.editor">配置文件编辑</h2>
            <button id="workspace-editor-modal-close-btn" class="secondary-btn" type="button" data-workspace-editor-close="true" data-i18n="common.close">
              关闭
            </button>
          </div>
          <div class="workspace-editor-modal-content workspace-neumorph">
            <section class="workspace-neumorph-block">
              <h3 data-i18n="workspace.editor">配置文件编辑</h3>
              <form id="workspace-editor-form" class="stack-form">
                <label>
                  <span data-i18n="workspace.selectedPath">当前配置文件路径</span>
                  <input id="workspace-file-path" type="text" readonly />
                </label>
                <label>
                  <span data-i18n="workspace.fileContent">配置内容</span>
                  <textarea id="workspace-file-content" rows="14" placeholder="{}"></textarea>
                </label>
                <div class="actions-row">
                  <button id="workspace-save-file-btn" type="submit" data-i18n="workspace.saveFile">保存到 PUT /workspace/files</button>
                  <button id="workspace-delete-file-btn" class="secondary-btn" type="button" data-i18n="workspace.deleteFile">删除文件</button>
                </div>
              </form>
            </section>

          </div>
        </section>
      </div>

      <div id="workspace-import-modal" class="modal-shell is-hidden" aria-hidden="true">
        <div class="modal-backdrop" data-workspace-import-close="true"></div>
        <section class="workspace-import-modal-panel" role="dialog" aria-modal="true" aria-labelledby="workspace-import-modal-title">
          <div class="workspace-import-modal-head">
            <h2 id="workspace-import-modal-title" data-i18n="workspace.importJSON">导入 JSON</h2>
            <button id="workspace-import-modal-close-btn" class="secondary-btn" type="button" data-workspace-import-close="true" data-i18n="common.close">
              关闭
            </button>
          </div>
          <p class="hint" data-i18n="workspace.transferHint">导入配置 `POST /workspace/import`。</p>
          <form id="workspace-import-form" class="stack-form">
            <label>
              <span data-i18n="workspace.jsonPayload">配置 JSON 内容</span>
              <textarea id="workspace-json" rows="12" placeholder='{"docs/readme.md":"hello"}'></textarea>
            </label>
            <button id="workspace-import-btn" type="submit" data-i18n="workspace.importJSON">导入 JSON</button>
          </form>
        </section>
      </div>

      <div id="cron-create-modal" class="modal-shell is-hidden" aria-hidden="true">
        <div class="modal-backdrop" data-cron-create-close="true"></div>
        <section class="workspace-editor-modal-panel cron-create-modal-panel" role="dialog" aria-modal="true" aria-labelledby="cron-create-modal-title">
          <div class="workspace-editor-modal-head">
            <h2 id="cron-create-modal-title" data-i18n="cron.createTextJob">创建间隔文本任务</h2>
            <button id="cron-create-modal-close-btn" class="secondary-btn" type="button" data-cron-create-close="true" data-i18n="common.close">
              关闭
            </button>
          </div>
          <div class="workspace-editor-modal-content workspace-neumorph">
            <section class="workspace-neumorph-block">
              <h3 id="cron-create-form-title" data-i18n="cron.createTextJob">创建间隔文本任务</h3>
              <p id="cron-dispatch-hint" class="hint"></p>
              <form id="cron-create-form" class="stack-form cron-form-grid">
                <label>
                  <span data-i18n="cron.id">ID</span>
                  <input id="cron-id" type="text" placeholder="job-demo" data-i18n-placeholder="cron.idPlaceholder" />
                </label>
                <label>
                  <span data-i18n="cron.name">名称</span>
                  <input id="cron-name" type="text" placeholder="示例任务" data-i18n-placeholder="cron.namePlaceholder" />
                </label>
                <label>
                  <span data-i18n="cron.intervalLabel">schedule.cron（间隔文本）</span>
                  <input id="cron-interval" type="text" placeholder="60s" value="60s" data-i18n-placeholder="cron.intervalPlaceholder" />
                </label>
                <label>
                  <span data-i18n="cron.dispatchSession">dispatch.target.session_id</span>
                  <input id="cron-session-id" type="text" />
                </label>
                <label>
                  <span data-i18n="cron.maxConcurrency">runtime.max_concurrency</span>
                  <input id="cron-max-concurrency" type="number" min="1" value="1" />
                </label>
                <label>
                  <span data-i18n="cron.timeoutSeconds">runtime.timeout_seconds</span>
                  <input id="cron-timeout-seconds" type="number" min="1" value="30" />
                </label>
                <label>
                  <span data-i18n="cron.misfireGraceSeconds">runtime.misfire_grace_seconds</span>
                  <input id="cron-misfire-grace" type="number" min="0" value="0" />
                </label>
                <label class="checkbox-inline">
                  <input id="cron-enabled" type="checkbox" checked />
                  <span data-i18n="cron.enabledSwitch">启用</span>
                </label>
                <label class="full-row">
                  <span data-i18n="cron.text">文本</span>
                  <textarea id="cron-text" rows="4" placeholder="定时消息文本" data-i18n-placeholder="cron.textPlaceholder"></textarea>
                </label>
                <div class="full-row actions-row">
                  <button id="cron-new-session" type="button" data-i18n="cron.newSession">生成新 Session ID</button>
                  <button id="cron-submit-btn" type="submit" data-i18n="cron.submitCreate">提交到 POST /cron/jobs</button>
                </div>
              </form>
            </section>
          </div>
        </section>
      </div>

      <div id="models-provider-modal" class="modal-shell is-hidden" role="dialog" aria-modal="true" aria-labelledby="models-provider-modal-title">
        <div class="modal-backdrop" data-modal-close="true"></div>
        <section class="modal-panel neumorph-panel">
          <div class="panel-head">
            <h3 id="models-provider-modal-title" data-i18n="models.addProviderTitle">添加提供商</h3>
            <button id="models-provider-modal-close-btn" type="button" class="secondary-btn" data-i18n="common.close">关闭</button>
          </div>
          <form id="models-provider-form" class="stack-form panel-body provider-form">
            <label>
              <span data-i18n="models.providerType">Provider type</span>
              <select id="models-provider-type-select"></select>
            </label>
            <label>
              <span data-i18n="models.providerName">Provider Name（展示名）</span>
              <input
                id="models-provider-name-input"
                type="text"
                placeholder="My OpenAI Gateway"
                data-i18n-placeholder="models.providerNamePlaceholder"
              />
            </label>
            <label>
              <span data-i18n="models.providerAPIKey">API Key（可选）</span>
              <input id="models-provider-api-key-input" type="password" placeholder="sk-***" data-i18n-placeholder="models.providerAPIKeyPlaceholder" />
            </label>
            <label>
              <span data-i18n="models.providerBaseURL">Base URL（可选）</span>
              <input
                id="models-provider-base-url-input"
                type="text"
                placeholder="http://127.0.0.1:19002/v1"
                data-i18n-placeholder="models.providerBaseURLPlaceholder"
              />
            </label>
            <label>
              <span data-i18n="models.providerTimeoutMS">timeout_ms（可选）</span>
              <input id="models-provider-timeout-ms-input" type="number" min="0" placeholder="15000" data-i18n-placeholder="models.providerTimeoutPlaceholder" />
            </label>
            <section class="provider-config-zone">
              <label class="checkbox-inline provider-enabled-toggle">
                <input id="models-provider-enabled-input" type="checkbox" checked />
                <span data-i18n="models.providerEnabled">启用 Provider</span>
              </label>
              <label class="provider-config-card">
                <span data-i18n="models.providerHeaders">headers（可选）</span>
                <div class="kv-editor">
                  <div id="models-provider-headers-rows" class="kv-rows" data-kv-kind="headers"></div>
                  <button id="models-provider-headers-add-btn" type="button" class="secondary-btn" data-i18n="models.addKVRow">添加一行</button>
                </div>
              </label>
              <label class="provider-config-card">
                <span data-i18n="models.providerAliases">model_aliases（可选）</span>
                <div class="kv-editor">
                  <div id="models-provider-aliases-rows" class="kv-rows" data-kv-kind="aliases"></div>
                  <button id="models-provider-aliases-add-btn" type="button" class="secondary-btn" data-i18n="models.addKVRow">添加一行</button>
                </div>
              </label>
              <label id="models-provider-custom-models-field" class="provider-config-card">
                <span data-i18n="models.customModels">自定义模型配置（可选）</span>
                <div class="kv-editor">
                  <div id="models-provider-custom-models-rows" class="custom-model-rows"></div>
                  <button id="models-provider-custom-models-add-btn" type="button" class="secondary-btn" data-i18n="models.addKVRow">添加一行</button>
                </div>
              </label>
            </section>
            <div class="actions-row">
              <button id="models-provider-cancel-btn" type="button" class="secondary-btn" data-i18n="common.cancel">取消</button>
              <button id="models-provider-save-btn" type="submit" data-i18n="models.saveProvider">保存 Provider</button>
            </div>
          </form>
        </section>
      </div>
    </div>
    <script type="module" src="./main.js"></script>
  </body>
</html>
